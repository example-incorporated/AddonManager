function rt(e){window.enmity.plugins.registerPlugin(e)}function F(e){return window.enmity.plugins.getPlugin(e)}function re(){return window.enmity.plugins.getPlugins()}const g=window.enmity.modules.common.Constants;window.enmity.modules.common.Clipboard,window.enmity.modules.common.Assets,window.enmity.modules.common.Messages,window.enmity.modules.common.Clyde,window.enmity.modules.common.Avatars;const it=window.enmity.modules.common.Native,t=window.enmity.modules.common.React;window.enmity.modules.common.Dispatcher,window.enmity.modules.common.Storage;const A=window.enmity.modules.common.Toasts,ie=window.enmity.modules.common.Dialog,lt=window.enmity.modules.common.Token,D=window.enmity.modules.common.REST;window.enmity.modules.common.Settings,window.enmity.modules.common.Users;const le=window.enmity.modules.common.Navigation,st=window.enmity.modules.common.NavigationNative,me=window.enmity.modules.common.NavigationStack;window.enmity.modules.common.Theme;const W=window.enmity.modules.common.Linking,C=window.enmity.modules.common.StyleSheet;window.enmity.modules.common.ColorMap,window.enmity.modules.common.Components,window.enmity.modules.common.Locale,window.enmity.modules.common.Profiles,window.enmity.modules.common.Lodash,window.enmity.modules.common.Logger,window.enmity.modules.common.Flux;const U=window.enmity.modules.common.SVG,ct=window.enmity.modules.common.Scenes;window.enmity.modules.common.Moment;function dt(e){return window.enmity.patcher.create(e)}var m="AddonManager",Ce="1.1.6",mt="Manage plugins & themes easily!",ut=[{name:"mafu",id:"519760564755365888"}],gt="#00ffff",ht={name:m,version:Ce,description:mt,authors:ut,color:gt};function b(e,n,o){window.enmity.settings.set(e,n,o)}function S(e,n,o){return window.enmity.settings.get(e,n,o)}const j="https://raw.githubusercontent.com/m4fn3/AddonManagerDatabase/master/",pt=j+"plugins.json",Et=j+"themes.json",wt=j+"plugins_update.txt",yt=j+"themes_update.txt",ft=j+"compatibility.json";function G(e){return`${e}?${Date.now()}`}function bt(e,n){return`${j}${e}s/${n}.json`}function ue(e){try{return JSON.parse(S(m,e,"{}").toString())}catch{return{}}}function X(){return ue("plugins")}function J(){return ue("themes")}function vt(){return ue("compatibility")}function Me(){D.get(G(pt)).then(e=>{b(m,"plugins",e.text)})}function Pe(){D.get(G(Et)).then(e=>{b(m,"themes",e.text)})}function St(){D.get(G(wt)).then(e=>{let n=e.text,o=S(m,"plugins_ver");o?o!=n&&(b(m,"plugins_ver",n),Me()):(b(m,"plugins_ver",n),Me())})}function Tt(){D.get(G(yt)).then(e=>{let n=e.text,o=S(m,"themes_ver");o?o!=n&&(b(m,"themes_ver",n),Pe()):(b(m,"themes_ver",n),Pe())})}const{components:u}=window.enmity;u.Alert;const _t=u.Button,Ct=u.FlatList,Re=u.Image;u.ImageBackground,u.KeyboardAvoidingView,u.Modal,u.Pressable,u.RefreshControl;const L=u.ScrollView;u.SectionList,u.StatusBar,u.StyleSheet,u.Switch;const k=u.Text,Mt=u.TextInput;u.TouchableHighlight;const Ne=u.TouchableOpacity;u.TouchableWithoutFeedback,u.Touchable;const ge=u.View;u.VirtualizedList,u.Form;const Pt=u.FormArrow;u.FormCTA,u.FormCTAButton,u.FormCardSection,u.FormCheckbox;const Rt=u.FormDivider;u.FormHint,u.FormIcon,u.FormInput,u.FormLabel,u.FormRadio;const r=u.FormRow,P=u.FormSection;u.FormSelect,u.FormSubLabel;const q=u.FormSwitch;u.FormTernaryCheckBox,u.FormText,u.FormTextColors,u.FormTextSizes;function T(e){return window.enmity.assets.getIDByName(e)}const B={byProps:(...e)=>window.enmity.modules.filters.byProps(...e),byName:(e,n)=>window.enmity.modules.filters.byName(e,n),byTypeName:(e,n)=>window.enmity.modules.filters.byTypeName(e,n),byDisplayName:(e,n)=>window.enmity.modules.filters.byDisplayName(e,n)};function Nt(e,n){return window.enmity.modules.getModule(e,n)}function Ie(...e){return window.enmity.modules.bulk(...e)}function H(...e){return window.enmity.modules.getByProps(...e)}function Ae(...e){return window.enmity.modules.getByName(...e)}function It(...e){return window.enmity.modules.getByKeyword(...e)}window.enmity.modules.common;const Z=It("getFocusedRoute"),ke=Ae("StaticSearchBarContainer"),At=H("acceptInviteAndTransitionToInviteChannel"),kt=H("AppState"),$t=H("DRMType","FilterType").default,$e=H("setString"),p={Copy:T("ic_message_copy"),GitHub:T("img_account_sync_github_white"),Twitter:T("img_account_sync_twitter_white"),Discord:T("Discord"),Update:T("toast_image_saved"),Export:T("ic_reply_24px"),Import:T("ic_leave_stage"),Fail:T("Small"),Download:T("ic_download_24px"),Check:T("ic_check_24px"),Clear:T("ic_input_clear_24px"),Uninstall:T("ic_trash_24px"),Settings:T("ic_settings_white_24px"),Add:T("hub-add"),SettingIcon:T("ic_rulebook"),Link:T("ic_link")},Q=C.createThemedStyleSheet({cardStyle:{backgroundColor:g.ThemeColorMap.BACKGROUND_MOBILE_PRIMARY,color:g.ThemeColorMap.TEXT_NORMAL},header:{backgroundColor:g.ThemeColorMap.BACKGROUND_MOBILE_SECONDARY,shadowColor:"transparent",elevation:0},headerText:{color:g.ThemeColorMap.HEADER_PRIMARY}}),xt={cardStyle:Q.cardStyle,headerStyle:Q.header,headerTitleContainerStyle:Q.headerText,headerTitleStyle:Q.headerText,headerBackTitleStyle:Q.headerText,headerBackImage:()=>t.createElement(r.Icon,{source:T("ios-back")}),headerTitleAlign:"center",safeAreaInsets:{top:0}};function Dt(e,n,o,a=186){let s=e.replace("#","");const c=(d,l,f)=>parseInt(d.substring(l[0],l[1]),f),h=c(s,[0,2],16),E=c(s,[2,4],16),i=c(s,[4,6],16);return(h+E+i)/(255*3)>a?o:n}function Y(e,n,o=()=>{}){window.enmity.plugins.installPlugin(n,a=>{a.name===void 0?A.open({content:`Failed to install ${e}`,source:p.Fail}):(A.open({content:`Successfully installed ${e}!`,source:p.Check}),o())})}function xe(e,n=()=>{}){window.enmity.plugins.uninstallPlugin(e,o=>{A.open({content:`Successfully uninstalled ${e}!`,source:p.Check}),n()})}function ee(e,n,o=()=>{}){window.enmity.themer.installTheme(n,a=>{A.open({content:`Successfully installed ${e}!`,source:p.Check}),o()})}function Lt(e,n=()=>{}){window.enmity.themer.uninstallTheme(e,o=>{A.open({content:`Successfully uninstalled ${e}!`,source:p.Check}),n()})}function V(e){return window.enmity.themer.getThemeByName(e)}function se(){return window.enmity.themer.listThemes()}function Bt(e){try{let n=V(window.enmity.themer.getTheme());return n?n.colours[e]:void 0}catch{return}}function ce(e,n){let o=he("plugin");o.push(n),b(m,`_updated_${e}s`,JSON.stringify(o))}function Ot(e){b(m,`_updated_${e}s`,"[]")}function he(e){return JSON.parse(S(m,`_updated_${e}s`,"[]").toString())}function Ft(){let e=S(m,"check_updates");if(e===void 0)b(m,"check_updates",!1);else if(e){const n=X(),o=J();let a=Ee(n),s=we(o);if(a.length||s.length){let c=a.concat(s).join(", ");A.open({content:`Updates are available for ${c}`,source:p.Download})}}}function pe(e,n){return n.localeCompare(e,void 0,{numeric:!0})}function De(e,n){return pe(e,n)===1}function Ee(e){return re().map(n=>n.name).filter(n=>Object.keys(e).includes(n)&&Object.keys(e[n]).includes("version")&&F(n).version&&De(F(n).version,e[n].version))}function we(e){return se().map(n=>n.name).filter(n=>Object.keys(e).includes(n)&&Object.keys(e[n]).includes("version")&&V(n).version&&De(V(n).version,e[n].version))}const Ut=H("updateNote");async function jt(e){let n=await(await fetch(`https://discord.com/api/v9/users/@me/notes/${e}`,{method:"GET",credentials:"include",headers:{authorization:lt.getToken()}})).json();return Object.keys(n).includes("note")?n.note:""}function Gt(e,n){Ut.updateNote(e,n)}function Le(){Gt("1048982327809818706",Be())}async function Ht(){return jt("1048982327809818706")}function Be(){let e=re().map(o=>o.name).join(";"),n=se().map(o=>o.name).join(";");return`${e}|${n}`}W.addEventListener("url",e=>{let n=e.url;n=decodeURIComponent(n.replace("com.hammerandchisel.discord://",""));try{const o=JSON.parse(n);S(m,"auto_backup")&&typeof o.data=="string"&&["installed_theme","overridden_theme","installed_plugin","overridden_plugin"].includes(o.data)&&Le()}catch{return}});function Oe({height:e,width:n,...o}){const a=C.createThemedStyleSheet({icon:{color:g.ThemeColorMap.INTERACTIVE_NORMAL,opacity:.75,marginLeft:.5}});return t.createElement(U.Svg,{viewBox:"0 0 24 24",style:{height:e,width:n,...a.icon},fill:"currentColor",...o},t.createElement(U.Path,{d:"M0 0h24v24H0z",fill:"none"}),t.createElement(U.Path,{d:"M20.5 11H19V7c0-1.1-.9-2-2-2h-4V3.5C13 2.12 11.88 1 10.5 1S8 2.12 8 3.5V5H4c-1.1 0-1.99.9-1.99 2v3.8H3.5c1.49 0 2.7 1.21 2.7 2.7s-1.21 2.7-2.7 2.7H2V20c0 1.1.9 2 2 2h3.8v-1.5c0-1.49 1.21-2.7 2.7-2.7 1.49 0 2.7 1.21 2.7 2.7V22H17c1.1 0 2-.9 2-2v-4h1.5c1.38 0 2.5-1.12 2.5-2.5S21.88 11 20.5 11z"}))}function Fe({height:e,width:n,...o}){const a=C.createThemedStyleSheet({icon:{color:g.ThemeColorMap.INTERACTIVE_NORMAL,opacity:.75,marginLeft:.5}});return t.createElement(U.Svg,{viewBox:"0 0 24 24",style:{height:e,width:n,...a.icon},fill:"currentColor",...o},t.createElement(U.Path,{d:"M0 0h24v24H0z",fill:"none"}),t.createElement(U.Path,{d:"M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8zm-5.5 9c-.83 0-1.5-.67-1.5-1.5S5.67 9 6.5 9 8 9.67 8 10.5 7.33 12 6.5 12zm3-4C8.67 8 8 7.33 8 6.5S8.67 5 9.5 5s1.5.67 1.5 1.5S10.33 8 9.5 8zm5 0c-.83 0-1.5-.67-1.5-1.5S13.67 5 14.5 5s1.5.67 1.5 1.5S15.33 8 14.5 8zm3 4c-.83 0-1.5-.67-1.5-1.5S16.67 9 17.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"}))}const{native:te}=window.enmity;function Yt(){te.reload()}const ye=te.version;te.build,te.device,te.version;var Ue=({content:e,addonType:n,addonName:o})=>{const a=C.createThemedStyleSheet({hyperLink:{color:g.ThemeColorMap.TEXT_LINK}});return e.replace(/(\bhttps?:\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*)/ig,"<l>$1<l>").split("<l>").map(s=>s.startsWith("http")?t.createElement(k,{style:a.hyperLink,onPress:()=>{let c=n=="plugin"?".js":".json";s.endsWith(c)?n=="plugin"?Y(o,s):ee(o,s):W.openURL(s)},onLongPress:()=>{$e.setString(s),A.open({content:"Copied URL to clipboard",source:p.Copy})}},s):t.createElement(k,null,s))};function K({addonType:e}){let n=Bt("PRIMARY_DARK_500"),o=n?Dt(n,g.ThemeColorMap.TEXT_NORMAL[0],g.ThemeColorMap.TEXT_NORMAL[1]):g.ThemeColorMap.HEADER_PRIMARY;n=n||g.ThemeColorMap.BACKGROUND_SECONDARY;const a=C.createThemedStyleSheet({container:{flex:1,backgroundColor:g.ThemeColorMap.BACKGROUND_PRIMARY,padding:10},previews:{marginTop:20,justifyContent:"center"},addonName:{color:g.ThemeColorMap.TEXT_NORMAL,fontFamily:g.Fonts.PRIMARY_SEMIBOLD,fontSize:20},addonText:{borderBottomWidth:1,borderBottomColor:g.ThemeColorMap.HEADER_PRIMARY,paddingBottom:20},sectionTitle:{marginTop:20,marginLeft:15,color:g.ThemeColorMap.HEADER_PRIMARY},sectionContent:{margin:10,borderRadius:10,borderWidth:1,borderColor:g.ThemeColorMap.HEADER_PRIMARY,color:g.ThemeColorMap.TEXT_NORMAL,padding:10},addonEdit:{backgroundColor:n,paddingTop:10,paddingBottom:10,borderRadius:20,borderWidth:1,width:80,alignItems:"center",borderColor:n,overflow:"hidden"},addonEditText:{color:o,fontFamily:g.Fonts.PRIMARY_SEMIBOLD},hyperLink:{color:g.ThemeColorMap.TEXT_LINK}}),s=kt.useWindowDimensions().width,[c,h]=t.useState("Loading description..."),[E,i]=t.useState([]),d=S(m,`_selected_${e}`).toString(),l=e=="plugin"?X():J(),f=l[d];let $=e=="plugin"?Ee(l):we(l),R=e=="plugin"?Boolean(F(d)):Boolean(V(d)),w=$.includes(d);const[y,oe]=t.useState(w),[ae,x]=t.useState(R?y?"UPDATE":"REMOVE":"GET"),[_e,at]=t.useState(void 0);return t.useEffect(()=>{D.get(G(bt(e,d))).then(_=>{let v=JSON.parse(_.text);h(v.description);let N=Object.assign(v.images.map(I=>({url:I,width:1,height:1,type:"image"})),v.videos.map(I=>({url:I,width:null,height:null,type:"video"})));i(N)}).catch(_=>{_.status===404&&h("No description.")});const M=vt();if(d in M[e]){let _=!0;if(M[e][d].ver.includes("~")){let v=M[e][d].ver.split("~"),N=v[0]?v[0]:"0.0",I=v[1]?v[1]:"999.0";pe(N,ye)>=0&&pe(ye,I)>=0&&(_=!1)}_&&at(M[e][d].text+`

Compatibility: ${M[e][d].ver} (currently on ${ye})`)}},[]),t.createElement(L,{style:a.container},t.createElement(r,{style:a.addonText,label:()=>t.createElement(k,{style:a.addonName},d),leading:e=="plugin"?t.createElement(Oe,{width:32,height:32}):t.createElement(Fe,{width:32,height:32}),trailing:t.createElement(Ne,{style:a.addonEdit,onPress:()=>{e=="plugin"?F(d)&&!y?xe(d,()=>x("GET")):Y(d,f.url,()=>{oe(!1),ce(e,d),x("REMOVE")}):V(d)&&!y?Lt(d,()=>x("GET")):ee(d,f.url,()=>{oe(!1),ce(e,d),x("REMOVE")})}},t.createElement(k,{style:a.addonEditText},ae)),subLabel:f.description}),[1].filter(M=>Boolean(_e)).map(M=>t.createElement(t.Fragment,null,t.createElement(k,{style:[a.sectionTitle,{color:"#e74c3c",fontFamily:g.Fonts.PRIMARY_SEMIBOLD}]},"Notice"),t.createElement(k,{style:[a.sectionContent,{borderColor:"#e74c3c"}]},t.createElement(Ue,{content:_e,addonType:e,addonName:d})))),t.createElement(Ct,{horizontal:!0,data:E,style:a.previews,renderItem:({index:M,item:_})=>{if(_.type=="image")return t.createElement(Re,{style:{width:_.width,height:_.height,margin:5},source:{uri:_.url},onLoad:({nativeEvent:{source:{width:v,height:N}}})=>{let I=v/N;v=I<1?s*2/5:s*2/3,N=v/I;let O=Object.assign([],E);O[M].width=v,O[M].height=N,i(O)}});if(_.type=="video")return t.createElement($t,{style:{width:_.width,height:_.height},source:{uri:_.url},controls:!0,paused:!0,onLoad:({naturalSize:{width:v,height:N}})=>{let I=v/N;v=I<1?s*2/5:s*2/3,N=v/I;let O=Object.assign([],E);O[M].width=v,O[M].height=N,i(O)}})},showsHorizontalScrollIndicator:!0}),t.createElement(k,{style:a.sectionTitle},"Description"),t.createElement(k,{style:a.sectionContent},t.createElement(Ue,{content:c,addonType:e,addonName:d})))}function je({isSetting:e=!1}){const n=C.createThemedStyleSheet({container:{flex:1,backgroundColor:g.ThemeColorMap.BACKGROUND_PRIMARY}}),o=Z.useNavigation(),a=X(),[s,c]=t.useState(""),[h,E]=t.useState(re().map(i=>i.name));return t.createElement(t.Fragment,null,t.createElement(ke,{placeholder:"Search plugins",onChangeText:i=>c(i)}),t.createElement(L,{style:n.container},Object.keys(a).sort().filter(i=>i.toLowerCase().includes(s.toLowerCase())).map(i=>t.createElement(r,{label:a[i].version?`${i} - v${a[i].version}`:i,subLabel:a[i].description,leading:h.includes(i)?t.createElement(r.Icon,{source:p.Uninstall}):t.createElement(r.Icon,{source:p.Download}),trailing:r.Arrow,onPress:()=>{b(m,"_selected_plugin",i),e?o.push("EnmityCustomPage",{Navigation:o,pageName:" ",pagePanel:()=>t.createElement(K,{addonType:"plugin"})}):o.navigate("PluginDetail")},onLongPress:()=>{h.includes(i)?xe(i,()=>{let d=Object.assign([],h);d.splice(d.indexOf(i),1),E(d)}):Y(i,a[i].url,()=>{let d=Object.assign([],h);d.push(i),E(d)})}}))))}function Ge({isSetting:e=!1}){const n=C.createThemedStyleSheet({container:{flex:1,backgroundColor:g.ThemeColorMap.BACKGROUND_PRIMARY}}),o=Z.useNavigation(),a=J(),[s,c]=t.useState(""),[h,E]=t.useState(se().map(i=>i.name));return t.createElement(t.Fragment,null,t.createElement(ke,{placeholder:"Search themes",onChangeText:i=>c(i)}),t.createElement(L,{style:n.container},Object.keys(a).sort().filter(i=>i.toLowerCase().includes(s.toLowerCase())).map(i=>t.createElement(r,{label:a[i].version?`${i} - v${a[i].version}`:i,subLabel:a[i].description,leading:h.includes(i)?t.createElement(r.Icon,{source:p.Uninstall}):t.createElement(r.Icon,{source:p.Download}),trailing:r.Arrow,onPress:()=>{b(m,"_selected_theme",i),e?o.push("EnmityCustomPage",{Navigation:o,pageName:" ",pagePanel:()=>t.createElement(K,{addonType:"theme"})}):o.navigate("ThemeDetail")}}))))}function He({isSetting:e=!1}){const n=C.createThemedStyleSheet({container:{flex:1,backgroundColor:g.ThemeColorMap.BACKGROUND_PRIMARY}}),o=Z.useNavigation(),a=Z.useIsFocused(),s=X(),c=J(),h=Ee(s),E=we(c);let[i,d]=t.useState(h.length?h:["@"]),[l,f]=t.useState(E.length?E:["@"]);const[$,R]=t.useState(Boolean(S(m,"check_updates",!0)));return t.useEffect(()=>{let w=he("plugin"),y=Object.assign([],i.filter(x=>!w.includes(x)));d(y.length?y:["@"]);let oe=he("theme"),ae=Object.assign([],l.filter(x=>!oe.includes(x)));f(ae.length?ae:["@"])},[a]),t.createElement(L,{style:n.container},t.createElement(P,{title:"UPDATE"},t.createElement(r,{label:"Check updates on startup",leading:t.createElement(r.Icon,{source:p.Update}),trailing:t.createElement(q,{value:$,onValueChange:w=>{R(w),b(m,"check_updates",w)}})})),t.createElement(P,{title:"PLUGINS"},i.map(w=>w==="@"?t.createElement(r,{label:"No updates are found for plugins"}):t.createElement(r,{label:w&&`${w} - v${F(w).version} -> v${s[w].version}`,subLabel:s[w].description,leading:t.createElement(r.Icon,{source:p.Download}),trailing:r.Arrow,onPress:()=>{b(m,"_selected_plugin",w),e?o.push("EnmityCustomPage",{Navigation:o,pageName:" ",pagePanel:()=>t.createElement(K,{addonType:"plugin"})}):o.navigate("PluginDetail")},onLongPress:()=>{Y(w,s[w].url,()=>{ce("plugin",w);let y=Object.assign([],i);y.splice(y.indexOf(w),1),d(y.length?y:["@"])})}}))),t.createElement(P,{title:"THEMES"},l.map(w=>w==="@"?t.createElement(r,{label:"No updates are found for themes"}):t.createElement(r,{label:w&&`${w} - v${V(w).version} -> v${c[w].version}`,subLabel:c[w].description,leading:t.createElement(r.Icon,{source:p.Download}),trailing:r.Arrow,onPress:()=>{b(m,"_selected_theme",w),e?o.push("EnmityCustomPage",{Navigation:o,pageName:" ",pagePanel:()=>t.createElement(K,{addonType:"theme"})}):o.navigate("ThemeDetail")},onLongPress:()=>{ee(w,c[w].url,()=>{ce("theme",w);let y=Object.assign([],l);y.splice(y.indexOf(w),1),f(y.length?y:["@"])})}}))))}function Ye(){const e=C.createThemedStyleSheet({container:{flex:1,backgroundColor:g.ThemeColorMap.BACKGROUND_PRIMARY},importText:{color:"white",height:40,paddingLeft:15}}),n=X(),o=J(),[a,s]=t.useState({"":{}}),[c,h]=t.useState({"":{}});function E(l){const f=re().map(y=>y.name),$=se().map(y=>y.name);let R={},w={};l[0].split(";").filter(y=>Object.keys(n).includes(y)).forEach(y=>{R[y]=Object.assign(n[y],{installed:f.includes(y)})}),s(Object.keys(R).length?R:{"":{}}),l[1].split(";").filter(y=>Object.keys(o).includes(y)).forEach(y=>{w[y]=Object.assign(o[y],{installed:$.includes(y)})}),h(Object.keys(w).length?w:{"":{}})}function i(l,f=void 0){let $=l.split("|");if($.length!=2){let R=f||"Invalid text format. Please make sure that you entered correct text.";return A.open({content:R,source:p.Fail}),!1}else return $}let d;return t.createElement(L,{style:e.container},t.createElement(P,{title:"IMPORT"},t.createElement(r,{style:e.importBackup,label:"Import from backup",subLabel:"Import installed addons from backup that linked to your discord account.",leading:t.createElement(r.Icon,{source:p.Import}),trailing:r.Arrow,onPress:()=>{Ht().then(l=>{let f=i(l,"No backup was found.");f&&(E(f),A.open({content:"Successfully imported addons from backup!",source:p.Check}))})}})),t.createElement(P,null,t.createElement(Mt,{style:e.importText,ref:l=>{d=l},placeholder:"Paste exported text",onSubmitEditing:l=>{let f=i(l.nativeEvent.text);f&&E(f)}}),t.createElement(r,{label:"Clear Input",trailing:r.Arrow,onPress:()=>{d.clear(),s({"":{}}),h({"":{}})}})),t.createElement(P,{title:"PLUGINS"},Object.keys(a).map(l=>a[l].url?t.createElement(r,{label:a[l].version?`${l} - v${a[l].version}`:l,subLabel:a[l].description,leading:a[l].installed?t.createElement(r.Icon,{source:p.Check}):t.createElement(r.Icon,{source:p.Download}),trailing:a[l].installed?void 0:r.Arrow,onPress:()=>{Y(l,n[l].url,()=>{let f=Object.assign({},a);f[l].installed=!0,s(f)})}}):t.createElement(r,{label:"There are no imported plugins yet"}))),t.createElement(P,{title:"THEMES"},Object.keys(c).map(l=>c[l].url?t.createElement(r,{label:c[l].version?`${l} - v${c[l].version}`:l,subLabel:c[l].description,leading:c[l].installed?t.createElement(r.Icon,{source:p.Check}):t.createElement(r.Icon,{source:p.Download}),trailing:c[l].installed?void 0:r.Arrow,onPress:()=>{ee(l,o[l].url,()=>{let f=Object.assign({},c);f[l].installed=!0,h(f)})}}):t.createElement(r,{label:"There are no imported themes yet"}))))}function Ve(){const e=C.createThemedStyleSheet({container:{flex:1,backgroundColor:g.ThemeColorMap.BACKGROUND_PRIMARY}}),[n,o]=t.useState(Boolean(S(m,"auto_backup")));return t.createElement(L,{style:e.container},t.createElement(P,{title:"EXPORT"},t.createElement(r,{label:"Automatically create backup",subLabel:"Automatically save backup of installed addons. It will be linked with your discord account.",leading:t.createElement(r.Icon,{source:p.Export}),trailing:t.createElement(q,{value:n,onValueChange:a=>{o(a),a&&Le(),b(m,"auto_backup",a)}})})),t.createElement(P,{title:"ADVANCED"},t.createElement(r,{label:"Export addons as text",subLabel:"Export installed addons as text that you can import manually.",leading:t.createElement(r.Icon,{source:p.Copy}),trailing:r.Arrow,onPress:()=>{$e.setString(Be()),A.open({content:"Copied addon list to clipboard!",source:p.Copy})}})))}const Vt="https://github.com/m4fn3/AddonManager",Kt="https://raw.githubusercontent.com/m4fn3/AddonManager/master/manifest.json",zt="https://raw.githubusercontent.com/m4fn3/AddonManager/master/dist/AddonManager.js",Wt="https://raw.githubusercontent.com/m4fn3/AddonManager/master/changelogs.json";function Ke(e,n){window.enmity.plugins.installPlugin(zt,()=>{ie.show({title:"AddonManager",body:`Updated from ${e} to ${n}!
Do you want to reload Discord now?`,confirmText:"Yes",cancelText:"Later",onConfirm:()=>Yt()})})}function ze(e=!1){D.get(Kt).then(n=>{const o=JSON.parse(n.text),a=F(o.name);o.version.localeCompare(a.version,void 0,{numeric:!0})===1?(e||!e&&S(m,"ignored",null)!=o.version)&&D.get(Wt).then(s=>{const c=JSON.parse(s.text);let h="";c[o.version]&&(h=`

- Changelogs
${c[o.version]}`),ie.show({title:"AddonManager",body:`New version v${o.version} is available!${h}`,confirmText:"Update",cancelText:"Ignore",onConfirm:()=>{b(m,"_updating",!0),Ke(a.version,o.version)},onCancel:()=>b(m,"ignored",o.version)})}):e?ie.show({title:"AddonManager",body:`You are using latest version v${a.version}!`,confirmText:"OK"}):b(m,"ignored",null)}).catch(n=>{n.status===404&&ie.show({title:"AddonManager",body:"Failed to check for updates. Please check GitHub manually.",confirmText:"GitHub",cancelText:"Close",onConfirm:()=>W.openURL(Vt)})})}function We(){const e=C.createThemedStyleSheet({container:{flex:1,backgroundColor:g.ThemeColorMap.BACKGROUND_PRIMARY}}),[n,o]=t.useState(Boolean(S(m,"check_updates_me",!0))),[a,s]=t.useState(Boolean(S(m,"add_to_settings",!0))),[c,h]=t.useState(Boolean(S(m,"long_press_downloader",!0)));return t.createElement(L,{style:e.container},t.createElement(P,{title:"OPTIONS"},t.createElement(r,{label:"Check updates of AddonManager itself on startup",subLabel:"You can also click here to check updates manually",leading:t.createElement(r.Icon,{source:p.Update}),trailing:t.createElement(q,{value:n,onValueChange:E=>{o(E),b(m,"check_updates_me",E)}}),onPress:()=>{ze(!0)}}),t.createElement(r,{label:"Add the AddonManager section to settings",leading:t.createElement(r.Icon,{source:p.Add}),trailing:t.createElement(q,{value:a,onValueChange:E=>{s(E),b(m,"add_to_settings",E)}})}),t.createElement(r,{label:"Show a download option on long press links",leading:t.createElement(r.Icon,{source:p.Link}),trailing:t.createElement(q,{value:c,onValueChange:E=>{h(E),b(m,"long_press_downloader",E)}})})))}const Xt=Ae("HelpMessage"),ne=me.createStackNavigator();function fe(){return t.createElement(ne.Navigator,{initialRouteName:"Home",headerMode:"screen",screenOptions:{...xt}},t.createElement(ne.Screen,{name:"Home",component:Xe,options:{headerShown:!1}}),[[je,"Plugins"],[Ge,"Themes"],[Ve,"Export"],[Ye,"Import"],[He,"Update"],[We,"Settings"]].map(([e,n])=>t.createElement(ne.Screen,{name:n,component:e})),t.createElement(ne.Screen,{name:"PluginDetail",component:()=>t.createElement(K,{addonType:"plugin"}),options:{title:""}}),t.createElement(ne.Screen,{name:"ThemeDetail",component:()=>t.createElement(K,{addonType:"theme"}),options:{title:""}}))}function Xe({settings:e}){const n=C.createThemedStyleSheet({container:{backgroundColor:g.ThemeColorMap.BACKGROUND_PRIMARY},header:{flexDirection:"row",justifyContent:"center",alignItems:"center"},image:{width:70,height:70,marginTop:20,marginLeft:20},title:{flexDirection:"column"},notice:{marginTop:30,marginLeft:20,marginRight:20},name:{fontSize:30,paddingTop:20,paddingLeft:20,paddingRight:30,color:g.ThemeColorMap.HEADER_PRIMARY},author:{fontSize:15,paddingLeft:50,color:g.ThemeColorMap.HEADER_SECONDARY},info:{height:45,paddingTop:3,paddingBottom:3,justifyContent:"center",alignItems:"center"},footer:{color:g.ThemeColorMap.HEADER_SECONDARY,textAlign:"center",paddingTop:10,paddingBottom:20}}),o=Z.useNavigation(),a=S(m,"ignored",null);return t.useEffect(()=>{D.get(G(ft)).then(s=>{b(m,"compatibility",s.text)})},[]),t.createElement(L,{style:n.container},t.createElement(ge,{style:n.header},t.createElement(Re,{source:{uri:"https://avatars.githubusercontent.com/u/43488869"},style:n.image}),t.createElement(ge,{style:n.title},t.createElement(k,{style:n.name},"AddonManager"),t.createElement(k,{style:n.author},"by mafu"))),a?t.createElement(Ne,{style:n.notice,onPress:()=>{const s=F(m);Ke(s.version,a)}},t.createElement(Xt,{messageType:0},`New version of AddonManager is available. Click here to update to v${a}!`)):t.createElement(t.Fragment,null),t.createElement(P,{title:"STORE"},t.createElement(r,{label:"Browse plugins",leading:t.createElement(Oe,{width:24,height:24}),trailing:r.Arrow,onPress:()=>{e?o.push("EnmityCustomPage",{Navigation:o,pageName:"Plugins",pagePanel:()=>t.createElement(je,{isSetting:!0})}):o.navigate("Plugins")}}),t.createElement(r,{label:"Browse themes",leading:t.createElement(Fe,{width:24,height:24}),trailing:r.Arrow,onPress:()=>{e?o.push("EnmityCustomPage",{Navigation:o,pageName:"Themes",pagePanel:()=>t.createElement(Ge,{isSetting:!0})}):o.navigate("Themes")}}),t.createElement(r,{label:"Export addons",leading:t.createElement(r.Icon,{source:p.Export}),trailing:r.Arrow,onPress:()=>{e?o.push("EnmityCustomPage",{Navigation:o,pageName:"Export",pagePanel:Ve}):o.navigate("Export")}}),t.createElement(r,{label:"Import addons",leading:t.createElement(r.Icon,{source:p.Import}),trailing:r.Arrow,onPress:()=>{e?o.push("EnmityCustomPage",{Navigation:o,pageName:"Import",pagePanel:Ye}):o.navigate("Import")}}),t.createElement(r,{label:"Update addons",leading:t.createElement(r.Icon,{source:p.Update}),trailing:r.Arrow,onPress:()=>{e?o.push("EnmityCustomPage",{Navigation:o,pageName:"Update",pagePanel:()=>t.createElement(He,{isSetting:!0})}):o.navigate("Update")}}),t.createElement(r,{label:"Settings",leading:t.createElement(r.Icon,{source:p.Settings}),trailing:r.Arrow,onPress:()=>{e?o.push("EnmityCustomPage",{Navigation:o,pageName:"Settings",pagePanel:()=>t.createElement(We,{isSetting:!0})}):o.navigate("Settings")}})),t.createElement(P,{title:"INFORMATION"},t.createElement(r,{label:"Follow me on Twitter",style:n.info,trailing:r.Arrow,leading:t.createElement(r.Icon,{source:p.Twitter}),onPress:()=>{W.openURL("https://twitter.com/m4fn3")}}),t.createElement(r,{label:"Visit my server for help",style:n.info,trailing:r.Arrow,leading:t.createElement(r.Icon,{source:p.Discord}),onPress:()=>{At.acceptInviteAndTransitionToInviteChannel({inviteKey:"TrCqPTCrdq",context:{location:"Invite Button Embed"},callback:()=>{o.pop()}})}}),t.createElement(r,{label:"Check Source on GitHub",style:n.info,trailing:r.Arrow,leading:t.createElement(r.Icon,{source:p.GitHub}),onPress:()=>{W.openURL("https://github.com/m4fn3/AddonManager")}})),t.createElement(k,{style:n.footer},`v${Ce}`))}var Je;(function(e){e[e.BuiltIn=0]="BuiltIn",e[e.Guild=1]="Guild",e[e.DM=2]="DM"})(Je||(Je={}));var be;(function(e){e[e.Chat=1]="Chat",e[e.User=2]="User",e[e.Message=3]="Message"})(be||(be={}));var qe;(function(e){e[e.BuiltIn=0]="BuiltIn",e[e.BuiltInText=1]="BuiltInText",e[e.BuiltInIntegration=2]="BuiltInIntegration",e[e.Bot=3]="Bot",e[e.Placeholder=4]="Placeholder"})(qe||(qe={}));var Ze;(function(e){e[e.Role=1]="Role",e[e.User=2]="User"})(Ze||(Ze={}));var Qe;(function(e){e[e.SubCommand=1]="SubCommand",e[e.SubCommandGroup=2]="SubCommandGroup",e[e.String=3]="String",e[e.Integer=4]="Integer",e[e.Boolean=5]="Boolean",e[e.User=6]="User",e[e.Channel=7]="Channel",e[e.Role=8]="Role",e[e.Mentionnable=9]="Mentionnable",e[e.Number=10]="Number",e[e.Attachment=11]="Attachment"})(Qe||(Qe={}));var et;(function(e){e[e.ApplicationCommand=2]="ApplicationCommand",e[e.MessageComponent=3]="MessageComponent"})(et||(et={}));const tt=me.createStackNavigator();var Jt=({name:e="AddonManager",component:n=ge}={})=>{const o=C.createThemedStyleSheet({container:{backgroundColor:g.ThemeColorMap.BACKGROUND_MOBILE_SECONDARY,flex:1},cardStyle:{backgroundColor:g.ThemeColorMap.BACKGROUND_MOBILE_PRIMARY,color:g.ThemeColorMap.TEXT_NORMAL},header:{backgroundColor:g.ThemeColorMap.BACKGROUND_MOBILE_SECONDARY,shadowColor:"transparent",elevation:0},headerText:{color:g.ThemeColorMap.HEADER_PRIMARY},headerButton:{color:g.ThemeColorMap.HEADER_PRIMARY}});return t.createElement(st.NavigationContainer,{independent:!0},t.createElement(tt.Navigator,{initialRouteName:e,style:o.container,screenOptions:{cardOverlayEnabled:!1,cardShadowEnabled:!1,cardStyle:o.cardStyle,headerStyle:o.header,headerTitleAlign:"center",safeAreaInsets:{top:0}}},t.createElement(tt.Screen,{name:e,component:n,options:{headerTitleStyle:{color:"white"},headerLeft:()=>t.createElement(_t,{color:o.headerButton.color,title:"Close",onPress:()=>le.pop()}),...me.TransitionPresets.ModalPresentationIOS}})))};function de(e,n,o){return window.enmity.utilities.findInReactTree(e,n,o)}const qt=Nt(e=>{var n,o,a;return(a=(o=(n=e._dispatcher)==null?void 0:n._actionHandlers)==null?void 0:o._dependencyGraph)==null?void 0:a.nodes});qt._dispatcher._actionHandlers._dependencyGraph.nodes;function Zt(e,n,o,a=!1){const[s,c]=Ie(B.byProps("EmojiRow"),B.byName("ActionSheet",!1)),{Version:h}=it.InfoDictionaryManager;parseInt(h.substring(0,3))>164?typeof c.default=="function"&&e.after(c,"default",(E,i,d)=>{const l=de(d,f=>f.sheetKey);!(l!=null&&l.sheetKey)||!l.sheetKey.includes(n)||(a?e.before:e.after)(l==null?void 0:l.content,"type",(f,$,R)=>{o($,R)})}):typeof s.default=="function"&&e.after(s,"default",(E,[i],d)=>{o(i,d)})}const[Qt,en,tn,nn,on,nt]=Ie(B.byName("MessagesConnected",!1),B.byName("MessagesWrapperConnected",!1),B.byProps("openPrivateChannel"),B.byName("UserSettingsOverviewWrapper",!1),B.byProps("transitionTo"),B.byProps("openLazy","hideActionSheet")),{Platform:{isPad:ve}}=H("View","Text");let Se=!1;const an=T("ic_information_24px"),ot="643945264868098049";function Te(){A.open({content:"nvm. It is the normal behaviour on iPad as of now.",source:an}),Se=!0,on.transitionTo("/channels/@me",void 0),tn.openPrivateChannel(ot)}const z=dt("AddonManager"),rn={...ht,onStart(){const e={id:"addon",name:"addon",displayName:"addon",description:"Open AddonManager",displayDescription:"Open AddonManager",type:be.Chat,execute:async function(a,s){ve?Te():le.push(Jt,{component:fe,name:"AddonManager"})}};this.commands=[e],Zt(z,"LongPressUrl",(a,s)=>{if(S(m,"long_press_downloader",!0)){let c=a[0].header.title;if(a[0].options.filter(h=>h.label.includes("Download")).length)return;if(c.startsWith("http")){if(c.endsWith(".js")){let h=c.split("/").slice(-1)[0].replace(".js","");a[0].options.unshift({label:"Download as a plugin",onPress:()=>{Y(h,c),nt.hideActionSheet()}})}else if(c.endsWith(".json")){let h=c.split("/").slice(-1)[0].replace(".json","");a[0].options.unshift({label:"Download as a theme",onPress:()=>{ee(h,c),nt.hideActionSheet()}})}}}},!0);const n=z.after(nn,"default",(a,s,c)=>{const h=de(c,E=>{var i;return((i=E.type)==null?void 0:i.name)==="UserSettingsOverview"});z.after(h.type.prototype,"render",({props:{navigation:E}},i,d)=>{const l=de(d,f=>f.key==="Enmity");!de(d,f=>f.label==="AddonManager")&&S(m,"add_to_settings",!0)&&l.props.children.push(t.createElement(Rt,null),t.createElement(r,{label:"AddonManager",leading:t.createElement(r.Icon,{source:p.SettingIcon}),trailing:t.createElement(Pt,null),onPress:()=>{ve?(le.pop(),Te()):E.push("AddonManager",{navigation:E})}})),n()})});z.after(ct,"default",(a,s,c)=>({...c,AddonManager:{key:"AddonManager",title:"AddonManager",render:()=>t.createElement(fe,null)}}));const o=Qt||en;z.after(o,"default",(a,s,c)=>{var h,E;if(Se&&((E=(h=s[0].channel)==null?void 0:h.recipients)==null?void 0:E.includes(ot)))return t.createElement(fe,null);Se=!1}),S(m,"check_updates_me",!0)&&(S(m,"_updating",!1)?b(m,"_updating",!1):ze()),["plugin","theme"].forEach(a=>Ot(a)),St(),Tt(),Ft()},onStop(){z.unpatchAll()},getSettingsPanel({settings:e}){return ve&&(le.pop(),Te()),t.createElement(Xe,{settings:e})}};rt(rn);
